<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive Constantine</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            line-height: 18px;
            color: #555;
        }
        
        .legend h4 {
            margin: 0 0 5px;
            color: #777;
        }
        
        .legend-item {
            margin: 5px 0;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            display: inline-block;
            margin-right: 8px;
            border-radius: 50%;
            vertical-align: middle;
        }
        
        .popup-content h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .popup-content p {
            margin: 5px 0;
            color: #555;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div>üó∫Ô∏è Chargement de la carte...</div>
    </div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Donn√©es √©tendues des arr√™ts de bus (en bleu)
        const arretsBus = [
            { lat: 36.365, lng: 6.6147, nom: "Arr√™t Bus Centre-Ville", type: "bus", id: 1 },
            { lat: 36.3650, lng: 6.6180, nom: "Arr√™t Bus Universit√©", type: "bus", id: 2 },
            { lat: 36.3600, lng: 6.6100, nom: "Arr√™t Bus Gare", type: "bus", id: 3 },
            { lat: 36.3680, lng: 6.6200, nom: "Arr√™t Bus Ciloc", type: "bus", id: 4 },
            { lat: 36.3620, lng: 6.6160, nom: "Arr√™t Bus Zouaghi", type: "bus", id: 5 },
            { lat: 36.3640, lng: 6.6180, nom: "Arr√™t Bus Bardo", type: "bus", id: 6 },
            { lat: 36.3590, lng: 6.6120, nom: "Arr√™t Bus Sidi Mabrouk", type: "bus", id: 7 },
            { lat: 36.3670, lng: 6.6150, nom: "Arr√™t Bus Bellevue", type: "bus", id: 8 },
            { lat: 36.3630, lng: 6.6190, nom: "Arr√™t Bus Plateau", type: "bus", id: 9 },
            { lat: 36.3610, lng: 6.6140, nom: "Arr√™t Bus Souika", type: "bus", id: 10 },
            { lat: 36.3580, lng: 6.6170, nom: "Arr√™t Bus Boumerzoug", type: "bus", id: 11 },
            { lat: 36.3690, lng: 6.6130, nom: "Arr√™t Bus Mansourah", type: "bus", id: 12 },
            { lat: 36.3660, lng: 6.6110, nom: "Arr√™t Bus Daksi", type: "bus", id: 13 },
            { lat: 36.3570, lng: 6.6150, nom: "Arr√™t Bus Kitouni", type: "bus", id: 14 },
            { lat: 36.3700, lng: 6.6170, nom: "Arr√™t Bus Nouveau Pole", type: "bus", id: 15 },
            { lat: 36.3550, lng: 6.6130, nom: "Arr√™t Bus Ziadia", type: "bus", id: 16 },
            { lat: 36.3720, lng: 6.6160, nom: "Arr√™t Bus Fadila Saadane", type: "bus", id: 17 },
            { lat: 36.3540, lng: 6.6110, nom: "Arr√™t Bus Boudraa Salah", type: "bus", id: 18 },
            { lat: 36.3710, lng: 6.6140, nom: "Arr√™t Bus Cite Aadl", type: "bus", id: 19 },
            { lat: 36.3530, lng: 6.6180, nom: "Arr√™t Bus Belle Vue", type: "bus", id: 20 }
        ];
        
        // Donn√©es √©tendues des stations de taxi (en jaune)
        const arretsTaxi = [
            { lat: 36.3660, lng: 6.6160, nom: "Station Taxi Place 1er Nov", type: "taxi", id: 1 },
            { lat: 36.3620, lng: 6.6200, nom: "Station Taxi A√©roport", type: "taxi", id: 2 },
            { lat: 36.3640, lng: 6.6120, nom: "Station Taxi H√¥tel", type: "taxi", id: 3 },
            { lat: 36.3580, lng: 6.6140, nom: "Station Taxi Gare", type: "taxi", id: 4 },
            { lat: 36.3690, lng: 6.6180, nom: "Station Taxi Universit√©", type: "taxi", id: 5 },
            { lat: 36.3650, lng: 6.6100, nom: "Station Taxi Centre", type: "taxi", id: 6 },
            { lat: 36.3610, lng: 6.6170, nom: "Station Taxi Bardo", type: "taxi", id: 7 },
            { lat: 36.3670, lng: 6.6130, nom: "Station Taxi Ciloc", type: "taxi", id: 8 },
            { lat: 36.3630, lng: 6.6150, nom: "Station Taxi Zouaghi", type: "taxi", id: 9 },
            { lat: 36.3590, lng: 6.6190, nom: "Station Taxi Plateau", type: "taxi", id: 10 },
            { lat: 36.3560, lng: 6.6160, nom: "Station Taxi Sidi Mabrouk", type: "taxi", id: 11 },
            { lat: 36.3700, lng: 6.6150, nom: "Station Taxi Mansourah", type: "taxi", id: 12 },
            { lat: 36.3680, lng: 6.6110, nom: "Station Taxi Bellevue", type: "taxi", id: 13 },
            { lat: 36.3550, lng: 6.6140, nom: "Station Taxi Boumerzoug", type: "taxi", id: 14 },
            { lat: 36.3720, lng: 6.6180, nom: "Station Taxi Fadila Saadane", type: "taxi", id: 15 }
        ];
        
        // Donn√©es √©tendues des taxis irr√©guliers (en rouge)
        const taxisIrreguliers = [
            { lat: 36.3670, lng: 6.6130, nom: "Taxi Irr√©gulier Ciloc", type: "taxi_irreg", id: 1 },
            { lat: 36.3610, lng: 6.6170, nom: "Taxi Irr√©gulier Bardo", type: "taxi_irreg", id: 2 },
            { lat: 36.3590, lng: 6.6150, nom: "Taxi Irr√©gulier Sidi Mabrouk", type: "taxi_irreg", id: 3 },
            { lat: 36.3650, lng: 6.6190, nom: "Taxi Irr√©gulier Universit√©", type: "taxi_irreg", id: 4 },
            { lat: 36.3630, lng: 6.6110, nom: "Taxi Irr√©gulier Centre", type: "taxi_irreg", id: 5 },
            { lat: 36.3680, lng: 6.6170, nom: "Taxi Irr√©gulier Zouaghi", type: "taxi_irreg", id: 6 },
            { lat: 36.3600, lng: 6.6130, nom: "Taxi Irr√©gulier Gare", type: "taxi_irreg", id: 7 },
            { lat: 36.3570, lng: 6.6180, nom: "Taxi Irr√©gulier Plateau", type: "taxi_irreg", id: 8 },
            { lat: 36.3690, lng: 6.6140, nom: "Taxi Irr√©gulier Mansourah", type: "taxi_irreg", id: 9 },
            { lat: 36.3660, lng: 6.6100, nom: "Taxi Irr√©gulier Daksi", type: "taxi_irreg", id: 10 },
            { lat: 36.3540, lng: 6.6160, nom: "Taxi Irr√©gulier Boumerzoug", type: "taxi_irreg", id: 11 },
            { lat: 36.3710, lng: 6.6120, nom: "Taxi Irr√©gulier Bellevue", type: "taxi_irreg", id: 12 }
        ];
        
        // Configuration des styles avec les couleurs demand√©es
        const styles = {
            bus: { color: '#0066ff', fillColor: '#0066ff', radius: 8 }, // Bleu pour les bus
            taxi: { color: '#ffff00', fillColor: '#ffff00', radius: 8 }, // Jaune pour les taxis
            taxi_irreg: { color: '#ff0000', fillColor: '#ff0000', radius: 8 } // Rouge pour les taxis irr√©guliers
        };
        
        // Initialisation de la carte
        function initMap() {
            // Masquer le loading
            document.getElementById('loading').style.display = 'none';
            
            // Cr√©er la carte centr√©e sur Constantine
            const map = L.map('map').setView([36.365, 6.6147], 13);
            
            // Ajouter les tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Fonction pour cr√©er un marqueur
            function createMarker(point, style) {
                const marker = L.circleMarker([point.lat, point.lng], {
                    color: '#333',
                    weight: 2,
                    fillColor: style.fillColor,
                    fillOpacity: 0.8,
                    radius: style.radius
                });
                
                // Popup avec informations d√©taill√©es
                const popupContent = `
                    <div class="popup-content">
                        <h3>${point.nom}</h3>
                        <p><strong>ID:</strong> ${point.id}</p>
                        <p><strong>Type:</strong> ${getTypeLabel(point.type)}</p>
                        <p><strong>Coordonn√©es:</strong> ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                return marker;
            }
            
            // Fonction pour obtenir le label du type
            function getTypeLabel(type) {
                switch(type) {
                    case 'bus': return 'Arr√™t de Bus';
                    case 'taxi': return 'Station de Taxi';
                    case 'taxi_irreg': return 'Taxi Irr√©gulier';
                    default: return 'Inconnu';
                }
            }
            
            // Ajouter tous les marqueurs pour chaque type
            console.log('Ajout des arr√™ts de bus:', arretsBus.length);
            arretsBus.forEach(point => {
                createMarker(point, styles.bus).addTo(map);
            });
            
            console.log('Ajout des stations de taxi:', arretsTaxi.length);
            arretsTaxi.forEach(point => {
                createMarker(point, styles.taxi).addTo(map);
            });
            
            console.log('Ajout des taxis irr√©guliers:', taxisIrreguliers.length);
            taxisIrreguliers.forEach(point => {
                createMarker(point, styles.taxi_irreg).addTo(map);
            });
            
            // Ajouter la l√©gende avec les nouvelles couleurs
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <h4>L√©gende</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #0066ff;"></span>
                        Arr√™ts de Bus (${arretsBus.length})
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ffff00; border: 1px solid #ccc;"></span>
                        Stations de Taxi (${arretsTaxi.length})
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ff0000;"></span>
                        Taxis Irr√©guliers (${taxisIrreguliers.length})
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        Total: ${arretsBus.length + arretsTaxi.length + taxisIrreguliers.length} points
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
            
            // Ajouter un contr√¥le d'√©chelle
            L.control.scale().addTo(map);
            
            // Calculer les limites pour centrer la vue sur tous les points
            const allPoints = [...arretsBus, ...arretsTaxi, ...taxisIrreguliers];
            if (allPoints.length > 0) {
                const group = new L.featureGroup(
                    allPoints.map(point => L.marker([point.lat, point.lng]))
                );
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            console.log('Carte interactive charg√©e avec succ√®s');
            console.log(`Total des points affich√©s: ${allPoints.length}`);
            console.log('- Arr√™ts de bus:', arretsBus.length);
            console.log('- Stations de taxi:', arretsTaxi.length);
            console.log('- Taxis irr√©guliers:', taxisIrreguliers.length);
        }
        
        // Initialiser la carte quand la page est charg√©e
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
