<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive Constantine</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            line-height: 18px;
            color: #555;
        }
        
        .legend h4 {
            margin: 0 0 5px;
            color: #777;
        }
        
        .legend-item {
            margin: 5px 0;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            display: inline-block;
            margin-right: 8px;
            border-radius: 50%;
            vertical-align: middle;
        }
        
        .popup-content h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .popup-content p {
            margin: 5px 0;
            color: #555;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div>🗺️ Chargement de la carte...</div>
    </div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Coordonnées exactes d'Ali Mendjli selon vos indications: 36° 14′ 45″ N, 6° 34′ 02″ E
        // Conversion en décimal: 36.245833°N, 6.567222°E
        const aliMendlijCoordinates = { lat: 36.245833, lng: 6.567222 };
        
        // Données des arrêts de bus (points bleus) - ALI MENDJLI REPOSITIONNÉ AVEC LES COORDONNÉES EXACTES
        const arretsBus = [
            // Constantine Centre historique
            { lat: 36.3700, lng: 6.6160, nom: "Arrêt Bus Université Constantine 1", type: "bus", id: 1 },
            { lat: 36.3680, lng: 6.6140, nom: "Arrêt Bus Cité Universitaire", type: "bus", id: 2 },
            { lat: 36.3720, lng: 6.6120, nom: "Arrêt Bus Pont Sidi M'Cid", type: "bus", id: 3 },
            { lat: 36.3650, lng: 6.6180, nom: "Arrêt Bus Centre-Ville Constantine", type: "bus", id: 4 },
            { lat: 36.3670, lng: 6.6200, nom: "Arrêt Bus Ciloc", type: "bus", id: 5 },
            
            // Sidi Mabrouk
            { lat: 36.3500, lng: 6.5980, nom: "Arrêt Bus Sidi Mabrouk Supérieur", type: "bus", id: 11 },
            { lat: 36.3480, lng: 6.6000, nom: "Arrêt Bus Sidi Mabrouk Centre", type: "bus", id: 12 },
            { lat: 36.3460, lng: 6.6020, nom: "Arrêt Bus Sidi Mabrouk Inférieur", type: "bus", id: 13 },
            
            // Daksi
            { lat: 36.3400, lng: 6.5900, nom: "Arrêt Bus Daksi Centre", type: "bus", id: 15 },
            { lat: 36.3380, lng: 6.5880, nom: "Arrêt Bus Daksi Sud", type: "bus", id: 16 },
            
            // Ain Smara
            { lat: 36.3300, lng: 6.5800, nom: "Arrêt Bus Ain Smara Centre", type: "bus", id: 18 },
            { lat: 36.3280, lng: 6.5780, nom: "Arrêt Bus Ain Smara Sud", type: "bus", id: 19 },
            
            // Ain Bey
            { lat: 36.3800, lng: 6.5900, nom: "Arrêt Bus Ain Bey Centre", type: "bus", id: 37 },
            { lat: 36.3820, lng: 6.5920, nom: "Arrêt Bus Ain Bey Nord", type: "bus", id: 38 },
            
            // ===== ALI MENDJLI - COORDONNÉES EXACTES 36° 14′ 45″ N, 6° 34′ 02″ E =====
            // Centre exact d'Ali Mendjli
            { lat: 36.245833, lng: 6.567222, nom: "Arrêt Bus Ali Mendjli Centre Principal", type: "bus", id: 25 },
            
            // Points autour du centre (rayon de ~300m)
            { lat: 36.248333, lng: 6.567222, nom: "Arrêt Bus Ali Mendjli Nord 1", type: "bus", id: 26 },
            { lat: 36.250333, lng: 6.567722, nom: "Arrêt Bus Ali Mendjli Nord 2", type: "bus", id: 27 },
            { lat: 36.243333, lng: 6.566722, nom: "Arrêt Bus Ali Mendjli Sud 1", type: "bus", id: 28 },
            { lat: 36.241333, lng: 6.566722, nom: "Arrêt Bus Ali Mendjli Sud 2", type: "bus", id: 29 },
            
            // Points Est-Ouest
            { lat: 36.245833, lng: 6.570222, nom: "Arrêt Bus Ali Mendjli Est 1", type: "bus", id: 30 },
            { lat: 36.246333, lng: 6.572222, nom: "Arrêt Bus Ali Mendjli Est 2", type: "bus", id: 31 },
            { lat: 36.245833, lng: 6.564222, nom: "Arrêt Bus Ali Mendjli Ouest 1", type: "bus", id: 32 },
            { lat: 36.244333, lng: 6.562222, nom: "Arrêt Bus Ali Mendjli Ouest 2", type: "bus", id: 33 },
            
            // Points diagonaux
            { lat: 36.247833, lng: 6.569222, nom: "Arrêt Bus Ali Mendjli Nord-Est", type: "bus", id: 34 },
            { lat: 36.247833, lng: 6.565222, nom: "Arrêt Bus Ali Mendjli Nord-Ouest", type: "bus", id: 35 },
            { lat: 36.243833, lng: 6.569222, nom: "Arrêt Bus Ali Mendjli Sud-Est", type: "bus", id: 36 },
            { lat: 36.243833, lng: 6.565222, nom: "Arrêt Bus Ali Mendjli Sud-Ouest", type: "bus", id: 37 },
            
            // Points périphériques
            { lat: 36.249833, lng: 6.567222, nom: "Arrêt Bus Ali Mendjli Université", type: "bus", id: 38 },
            { lat: 36.245833, lng: 6.573222, nom: "Arrêt Bus Ali Mendjli Commercial", type: "bus", id: 39 },
            { lat: 36.242333, lng: 6.567222, nom: "Arrêt Bus Ali Mendjli Terminal", type: "bus", id: 40 },
            { lat: 36.245833, lng: 6.561222, nom: "Arrêt Bus Ali Mendjli Résidentiel", type: "bus", id: 41 },
            
            // ===== EL KHROUB - NOMBREUX POINTS AJOUTÉS =====
            { lat: 36.4560, lng: 6.6920, nom: "Arrêt Bus El Khroub Centre", type: "bus", id: 60 },
            { lat: 36.4540, lng: 6.6900, nom: "Arrêt Bus El Khroub Gare", type: "bus", id: 61 },
            { lat: 36.4580, lng: 6.6940, nom: "Arrêt Bus El Khroub Souk", type: "bus", id: 62 },
            { lat: 36.4520, lng: 6.6880, nom: "Arrêt Bus El Khroub Sud", type: "bus", id: 63 },
            { lat: 36.4600, lng: 6.6960, nom: "Arrêt Bus El Khroub Nord", type: "bus", id: 64 },
            { lat: 36.4570, lng: 6.6930, nom: "Arrêt Bus El Khroub Cité", type: "bus", id: 65 },
            { lat: 36.4550, lng: 6.6910, nom: "Arrêt Bus El Khroub Résidentiel", type: "bus", id: 66 },
            { lat: 36.4590, lng: 6.6950, nom: "Arrêt Bus El Khroub Commercial", type: "bus", id: 67 },
            { lat: 36.4530, lng: 6.6890, nom: "Arrêt Bus El Khroub Industriel", type: "bus", id: 68 },
            { lat: 36.4610, lng: 6.6970, nom: "Arrêt Bus El Khroub Université", type: "bus", id: 69 },
            { lat: 36.4575, lng: 6.6925, nom: "Arrêt Bus El Khroub Est", type: "bus", id: 70 },
            { lat: 36.4545, lng: 6.6905, nom: "Arrêt Bus El Khroub Ouest", type: "bus", id: 71 },
            { lat: 36.4585, lng: 6.6945, nom: "Arrêt Bus El Khroub Terminal", type: "bus", id: 72 },
            { lat: 36.4535, lng: 6.6885, nom: "Arrêt Bus El Khroub Périphérie", type: "bus", id: 73 },
            { lat: 36.4565, lng: 6.6935, nom: "Arrêt Bus El Khroub Principal", type: "bus", id: 74 }
        ];
        
        // Données des stations de taxi (points jaunes) - ALI MENDJLI AVEC COORDONNÉES EXACTES
        const arretsTaxi = [
            // Constantine Centre
            { lat: 36.3665, lng: 6.6150, nom: "Station Taxi Place 1er Nov", type: "taxi", id: 1 },
            { lat: 36.3685, lng: 6.6170, nom: "Station Taxi Université", type: "taxi", id: 2 },
            { lat: 36.3645, lng: 6.6130, nom: "Station Taxi Bardo", type: "taxi", id: 3 },
            
            // Sidi Mabrouk
            { lat: 36.3490, lng: 6.5990, nom: "Station Taxi Sidi Mabrouk", type: "taxi", id: 7 },
            
            // Daksi
            { lat: 36.3390, lng: 6.5890, nom: "Station Taxi Daksi", type: "taxi", id: 9 },
            
            // Ain Smara
            { lat: 36.3290, lng: 6.5790, nom: "Station Taxi Ain Smara", type: "taxi", id: 10 },
            
            // Ain Bey
            { lat: 36.3810, lng: 6.5910, nom: "Station Taxi Ain Bey", type: "taxi", id: 20 },
            
            // ===== ALI MENDJLI STATIONS DE TAXI - COORDONNÉES EXACTES =====
            { lat: 36.245833, lng: 6.567222, nom: "Station Taxi Ali Mendjli Centre", type: "taxi", id: 13 },
            { lat: 36.248333, lng: 6.567722, nom: "Station Taxi Ali Mendjli Nord", type: "taxi", id: 14 },
            { lat: 36.243333, lng: 6.566722, nom: "Station Taxi Ali Mendjli Sud", type: "taxi", id: 15 },
            { lat: 36.245833, lng: 6.570222, nom: "Station Taxi Ali Mendjli Est", type: "taxi", id: 16 },
            { lat: 36.245833, lng: 6.564222, nom: "Station Taxi Ali Mendjli Ouest", type: "taxi", id: 17 },
            { lat: 36.246833, lng: 6.568222, nom: "Station Taxi Ali Mendjli Commercial", type: "taxi", id: 18 },
            { lat: 36.249333, lng: 6.567222, nom: "Station Taxi Ali Mendjli Université", type: "taxi", id: 19 },
            { lat: 36.245833, lng: 6.571222, nom: "Station Taxi Ali Mendjli Terminal", type: "taxi", id: 21 },
            { lat: 36.247833, lng: 6.565222, nom: "Station Taxi Ali Mendjli Résidentiel", type: "taxi", id: 22 },
            { lat: 36.244833, lng: 6.569222, nom: "Station Taxi Ali Mendjli Express", type: "taxi", id: 23 },
            
            // ===== EL KHROUB STATIONS DE TAXI =====
            { lat: 36.4550, lng: 6.6910, nom: "Station Taxi El Khroub Centre", type: "taxi", id: 30 },
            { lat: 36.4570, lng: 6.6930, nom: "Station Taxi El Khroub Gare", type: "taxi", id: 31 },
            { lat: 36.4590, lng: 6.6950, nom: "Station Taxi El Khroub Nord", type: "taxi", id: 32 },
            { lat: 36.4530, lng: 6.6890, nom: "Station Taxi El Khroub Sud", type: "taxi", id: 33 },
            { lat: 36.4580, lng: 6.6940, nom: "Station Taxi El Khroub Commercial", type: "taxi", id: 34 },
            { lat: 36.4540, lng: 6.6900, nom: "Station Taxi El Khroub Terminal", type: "taxi", id: 35 },
            { lat: 36.4560, lng: 6.6920, nom: "Station Taxi El Khroub Principal", type: "taxi", id: 36 },
            { lat: 36.4575, lng: 6.6935, nom: "Station Taxi El Khroub Express", type: "taxi", id: 37 },
            { lat: 36.4545, lng: 6.6905, nom: "Station Taxi El Khroub Urbain", type: "taxi", id: 38 },
            { lat: 36.4565, lng: 6.6925, nom: "Station Taxi El Khroub Intercommunal", type: "taxi", id: 39 }
        ];
        
        // Données des taxis irréguliers (points rouges) - ALI MENDJLI AVEC COORDONNÉES EXACTES
        const taxisIrreguliers = [
            // Constantine Centre
            { lat: 36.3675, lng: 6.6135, nom: "Taxi Irrégulier Pont Sidi M'Cid", type: "taxi_irreg", id: 1 },
            { lat: 36.3655, lng: 6.6175, nom: "Taxi Irrégulier Centre", type: "taxi_irreg", id: 2 },
            
            // Sidi Mabrouk
            { lat: 36.3485, lng: 6.5995, nom: "Taxi Irrégulier Sidi Mabrouk", type: "taxi_irreg", id: 5 },
            
            // Daksi
            { lat: 36.3395, lng: 6.5895, nom: "Taxi Irrégulier Daksi", type: "taxi_irreg", id: 7 },
            
            // Ain Smara
            { lat: 36.3295, lng: 6.5795, nom: "Taxi Irrégulier Ain Smara", type: "taxi_irreg", id: 8 },
            
            // ===== ALI MENDJLI TAXIS IRRÉGULIERS - COORDONNÉES EXACTES =====
            { lat: 36.246333, lng: 6.567722, nom: "Taxi Irrégulier Ali Mendjli Centre 1", type: "taxi_irreg", id: 12 },
            { lat: 36.247333, lng: 6.566722, nom: "Taxi Irrégulier Ali Mendjli Centre 2", type: "taxi_irreg", id: 13 },
            { lat: 36.244833, lng: 6.567722, nom: "Taxi Irrégulier Ali Mendjli Centre 3", type: "taxi_irreg", id: 14 },
            { lat: 36.248833, lng: 6.568222, nom: "Taxi Irrégulier Ali Mendjli Nord 1", type: "taxi_irreg", id: 15 },
            { lat: 36.249833, lng: 6.566222, nom: "Taxi Irrégulier Ali Mendjli Nord 2", type: "taxi_irreg", id: 16 },
            { lat: 36.250333, lng: 6.568722, nom: "Taxi Irrégulier Ali Mendjli Nord 3", type: "taxi_irreg", id: 17 },
            { lat: 36.242833, lng: 6.567222, nom: "Taxi Irrégulier Ali Mendjli Sud 1", type: "taxi_irreg", id: 18 },
            { lat: 36.241833, lng: 6.566222, nom: "Taxi Irrégulier Ali Mendjli Sud 2", type: "taxi_irreg", id: 19 },
            { lat: 36.245833, lng: 6.571722, nom: "Taxi Irrégulier Ali Mendjli Est 1", type: "taxi_irreg", id: 20 },
            { lat: 36.246833, lng: 6.572222, nom: "Taxi Irrégulier Ali Mendjli Est 2", type: "taxi_irreg", id: 21 },
            { lat: 36.245333, lng: 6.563222, nom: "Taxi Irrégulier Ali Mendjli Ouest 1", type: "taxi_irreg", id: 22 },
            { lat: 36.244333, lng: 6.562722, nom: "Taxi Irrégulier Ali Mendjli Ouest 2", type: "taxi_irreg", id: 23 },
            { lat: 36.249333, lng: 6.569222, nom: "Taxi Irrégulier Ali Mendjli Université", type: "taxi_irreg", id: 24 },
            
            // ===== EL KHROUB TAXIS IRRÉGULIERS =====
            { lat: 36.4545, lng: 6.6905, nom: "Taxi Irrégulier El Khroub Centre 1", type: "taxi_irreg", id: 25 },
            { lat: 36.4555, lng: 6.6915, nom: "Taxi Irrégulier El Khroub Centre 2", type: "taxi_irreg", id: 26 },
            { lat: 36.4565, lng: 6.6925, nom: "Taxi Irrégulier El Khroub Centre 3", type: "taxi_irreg", id: 27 },
            { lat: 36.4575, lng: 6.6935, nom: "Taxi Irrégulier El Khroub Nord 1", type: "taxi_irreg", id: 28 },
            { lat: 36.4585, lng: 6.6945, nom: "Taxi Irrégulier El Khroub Nord 2", type: "taxi_irreg", id: 29 },
            { lat: 36.4525, lng: 6.6885, nom: "Taxi Irrégulier El Khroub Sud 1", type: "taxi_irreg", id: 30 },
            { lat: 36.4535, lng: 6.6895, nom: "Taxi Irrégulier El Khroub Sud 2", type: "taxi_irreg", id: 31 },
            { lat: 36.4580, lng: 6.6940, nom: "Taxi Irrégulier El Khroub Commercial", type: "taxi_irreg", id: 32 },
            { lat: 36.4570, lng: 6.6930, nom: "Taxi Irrégulier El Khroub Gare", type: "taxi_irreg", id: 33 },
            { lat: 36.4590, lng: 6.6950, nom: "Taxi Irrégulier El Khroub Terminal", type: "taxi_irreg", id: 34 },
            { lat: 36.4540, lng: 6.6900, nom: "Taxi Irrégulier El Khroub Périphérie 1", type: "taxi_irreg", id: 35 },
            { lat: 36.4560, lng: 6.6920, nom: "Taxi Irrégulier El Khroub Périphérie 2", type: "taxi_irreg", id: 36 },
            { lat: 36.4550, lng: 6.6910, nom: "Taxi Irrégulier El Khroub Express", type: "taxi_irreg", id: 37 }
        ];
        
        // Configuration des styles avec les couleurs demandées
        const styles = {
            bus: { color: '#0066ff', fillColor: '#0066ff', radius: 8 },
            taxi: { color: '#ffff00', fillColor: '#ffff00', radius: 8 },
            taxi_irreg: { color: '#ff0000', fillColor: '#ff0000', radius: 8 }
        };
        
        // Initialisation de la carte
        function initMap() {
            // Masquer le loading
            document.getElementById('loading').style.display = 'none';
            
            // Créer la carte centrée sur Constantine avec zoom ajusté
            const map = L.map('map').setView([36.365, 6.6147], 11);
            
            // Ajouter les tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            
            // Fonction pour créer un marqueur
            function createMarker(point, style) {
                const marker = L.circleMarker([point.lat, point.lng], {
                    color: '#333',
                    weight: 2,
                    fillColor: style.fillColor,
                    fillOpacity: 0.8,
                    radius: style.radius
                });
                
                // Popup avec informations détaillées
                const popupContent = `
                    <div class="popup-content">
                        <h3>${point.nom}</h3>
                        <p><strong>ID:</strong> ${point.id}</p>
                        <p><strong>Type:</strong> ${getTypeLabel(point.type)}</p>
                        <p><strong>Coordonnées:</strong> ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                return marker;
            }
            
            // Fonction pour obtenir le label du type
            function getTypeLabel(type) {
                switch(type) {
                    case 'bus': return 'Arrêt de Bus';
                    case 'taxi': return 'Station de Taxi';
                    case 'taxi_irreg': return 'Taxi Irrégulier';
                    default: return 'Inconnu';
                }
            }
            
            // Ajouter tous les marqueurs pour chaque type
            console.log('Ajout des arrêts de bus:', arretsBus.length);
            arretsBus.forEach(point => {
                createMarker(point, styles.bus).addTo(map);
            });
            
            console.log('Ajout des stations de taxi:', arretsTaxi.length);
            arretsTaxi.forEach(point => {
                createMarker(point, styles.taxi).addTo(map);
            });
            
            console.log('Ajout des taxis irréguliers:', taxisIrreguliers.length);
            taxisIrreguliers.forEach(point => {
                createMarker(point, styles.taxi_irreg).addTo(map);
            });
            
            // Ajouter la légende
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <h4>Légende</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #0066ff;"></span>
                        Arrêts de Bus
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ffff00; border: 1px solid #ccc;"></span>
                        Stations de Taxi
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ff0000;"></span>
                        Taxis Irréguliers
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
            
            // Ajouter un contrôle d'échelle
            L.control.scale().addTo(map);
            
            // Calculer les limites pour centrer la vue sur tous les points
            const allPoints = [...arretsBus, ...arretsTaxi, ...taxisIrreguliers];
            if (allPoints.length > 0) {
                const group = new L.featureGroup(
                    allPoints.map(point => L.marker([point.lat, point.lng]))
                );
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            console.log('Carte interactive chargée avec succès');
            console.log(`Total des points affichés: ${allPoints.length}`);
            console.log('- Arrêts de bus:', arretsBus.length);
            console.log('- Stations de taxi:', arretsTaxi.length);
            console.log('- Taxis irréguliers:', taxisIrreguliers.length);
            console.log('ALI MENDJLI REPOSITIONNÉ AUX COORDONNÉES EXACTES: 36° 14\' 45" N, 6° 34\' 02" E');
        }
        
        // Initialiser la carte quand la page est chargée
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
