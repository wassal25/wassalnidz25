<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Interactive Constantine</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            line-height: 18px;
            color: #555;
        }
        
        .legend h4 {
            margin: 0 0 5px;
            color: #777;
        }
        
        .legend-item {
            margin: 5px 0;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            display: inline-block;
            margin-right: 8px;
            border-radius: 50%;
            vertical-align: middle;
        }
        
        .popup-content h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .popup-content p {
            margin: 5px 0;
            color: #555;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div>üó∫Ô∏è Chargement de la carte...</div>
    </div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Donn√©es des arr√™ts de bus (points bleus) - distribution g√©ographique correcte
        const arretsBus = [
            // Constantine Centre historique
            { lat: 36.3700, lng: 6.6160, nom: "Arr√™t Bus Universit√© Constantine 1", type: "bus", id: 1 },
            { lat: 36.3680, lng: 6.6140, nom: "Arr√™t Bus Cit√© Universitaire", type: "bus", id: 2 },
            { lat: 36.3720, lng: 6.6120, nom: "Arr√™t Bus Pont Sidi M'Cid", type: "bus", id: 3 },
            { lat: 36.3650, lng: 6.6180, nom: "Arr√™t Bus Centre-Ville Constantine", type: "bus", id: 4 },
            { lat: 36.3670, lng: 6.6200, nom: "Arr√™t Bus Ciloc", type: "bus", id: 5 },
            { lat: 36.3640, lng: 6.6140, nom: "Arr√™t Bus Bardo", type: "bus", id: 6 },
            { lat: 36.3690, lng: 6.6180, nom: "Arr√™t Bus Zouaghi", type: "bus", id: 7 },
            { lat: 36.3660, lng: 6.6120, nom: "Arr√™t Bus Souika", type: "bus", id: 8 },
            { lat: 36.3710, lng: 6.6100, nom: "Arr√™t Bus Bellevue", type: "bus", id: 9 },
            { lat: 36.3630, lng: 6.6160, nom: "Arr√™t Bus Gare Routi√®re", type: "bus", id: 10 },
            
            // Sidi Mabrouk
            { lat: 36.3500, lng: 6.5980, nom: "Arr√™t Bus Sidi Mabrouk Sup√©rieur", type: "bus", id: 11 },
            { lat: 36.3480, lng: 6.6000, nom: "Arr√™t Bus Sidi Mabrouk Centre", type: "bus", id: 12 },
            { lat: 36.3460, lng: 6.6020, nom: "Arr√™t Bus Sidi Mabrouk Inf√©rieur", type: "bus", id: 13 },
            { lat: 36.3520, lng: 6.5960, nom: "Arr√™t Bus Sidi Mabrouk Nord", type: "bus", id: 14 },
            
            // Daksi
            { lat: 36.3400, lng: 6.5900, nom: "Arr√™t Bus Daksi Centre", type: "bus", id: 15 },
            { lat: 36.3380, lng: 6.5880, nom: "Arr√™t Bus Daksi Sud", type: "bus", id: 16 },
            { lat: 36.3420, lng: 6.5920, nom: "Arr√™t Bus Daksi Nord", type: "bus", id: 17 },
            
            // Ain Smara
            { lat: 36.3300, lng: 6.5800, nom: "Arr√™t Bus Ain Smara Centre", type: "bus", id: 18 },
            { lat: 36.3280, lng: 6.5780, nom: "Arr√™t Bus Ain Smara Sud", type: "bus", id: 19 },
            { lat: 36.3320, lng: 6.5820, nom: "Arr√™t Bus Ain Smara Nord", type: "bus", id: 20 },
            { lat: 36.3260, lng: 6.5760, nom: "Arr√™t Bus Ain Smara Ouest", type: "bus", id: 21 },
            
            // Gammas/Boussouf
            { lat: 36.3560, lng: 6.6160, nom: "Arr√™t Bus Gammas", type: "bus", id: 22 },
            { lat: 36.3540, lng: 6.6140, nom: "Arr√™t Bus Boussouf", type: "bus", id: 23 },
            { lat: 36.3580, lng: 6.6180, nom: "Arr√™t Bus Gammas Nord", type: "bus", id: 24 },
            
            // Ali Mendjli (Nouvelle Ville) - Plus de points distribu√©s
            { lat: 36.2850, lng: 6.6420, nom: "Arr√™t Bus Ali Mendjli Centre Commercial", type: "bus", id: 25 },
            { lat: 36.2830, lng: 6.6400, nom: "Arr√™t Bus Ali Mendjli Universit√©", type: "bus", id: 26 },
            { lat: 36.2870, lng: 6.6440, nom: "Arr√™t Bus Ali Mendjli Nord", type: "bus", id: 27 },
            { lat: 36.2810, lng: 6.6380, nom: "Arr√™t Bus Ali Mendjli Sud", type: "bus", id: 28 },
            { lat: 36.2890, lng: 6.6460, nom: "Arr√™t Bus Ali Mendjli Est", type: "bus", id: 29 },
            { lat: 36.2800, lng: 6.6420, nom: "Arr√™t Bus Ali Mendjli Ouest", type: "bus", id: 30 },
            { lat: 36.2860, lng: 6.6380, nom: "Arr√™t Bus Ali Mendjli Cit√© 1", type: "bus", id: 31 },
            { lat: 36.2840, lng: 6.6460, nom: "Arr√™t Bus Ali Mendjli Cit√© 2", type: "bus", id: 32 },
            { lat: 36.2820, lng: 6.6440, nom: "Arr√™t Bus Ali Mendjli Cit√© 3", type: "bus", id: 33 },
            { lat: 36.2880, lng: 6.6400, nom: "Arr√™t Bus Ali Mendjli R√©sidentiel", type: "bus", id: 34 },
            { lat: 36.2790, lng: 6.6400, nom: "Arr√™t Bus Ali Mendjli Terminal", type: "bus", id: 35 },
            { lat: 36.2900, lng: 6.6420, nom: "Arr√™t Bus Ali Mendjli Industriel", type: "bus", id: 36 },
            { lat: 36.2780, lng: 6.6440, nom: "Arr√™t Bus Ali Mendjli P√©riph√©rie", type: "bus", id: 37 },
            { lat: 36.2910, lng: 6.6480, nom: "Arr√™t Bus Ali Mendjli Extension", type: "bus", id: 38 },
            
            // El Khroub
            { lat: 36.4560, lng: 6.6920, nom: "Arr√™t Bus El Khroub Centre", type: "bus", id: 39 },
            { lat: 36.4540, lng: 6.6900, nom: "Arr√™t Bus El Khroub Gare", type: "bus", id: 40 },
            { lat: 36.4580, lng: 6.6940, nom: "Arr√™t Bus El Khroub Nord", type: "bus", id: 41 },
            { lat: 36.4520, lng: 6.6880, nom: "Arr√™t Bus El Khroub Sud", type: "bus", id: 42 },
            { lat: 36.4600, lng: 6.6960, nom: "Arr√™t Bus El Khroub Est", type: "bus", id: 43 },
            { lat: 36.4500, lng: 6.6860, nom: "Arr√™t Bus El Khroub Ouest", type: "bus", id: 44 },
            { lat: 36.4570, lng: 6.6880, nom: "Arr√™t Bus El Khroub Industriel", type: "bus", id: 45 },
            { lat: 36.4530, lng: 6.6920, nom: "Arr√™t Bus El Khroub R√©sidentiel", type: "bus", id: 46 }
        ];
        
        // Donn√©es des stations de taxi (points jaunes)
        const arretsTaxi = [
            // Constantine Centre
            { lat: 36.3665, lng: 6.6150, nom: "Station Taxi Place 1er Nov", type: "taxi", id: 1 },
            { lat: 36.3685, lng: 6.6170, nom: "Station Taxi Universit√©", type: "taxi", id: 2 },
            { lat: 36.3645, lng: 6.6130, nom: "Station Taxi Bardo", type: "taxi", id: 3 },
            { lat: 36.3695, lng: 6.6190, nom: "Station Taxi Ciloc", type: "taxi", id: 4 },
            { lat: 36.3625, lng: 6.6110, nom: "Station Taxi Gare", type: "taxi", id: 5 },
            { lat: 36.3705, lng: 6.6140, nom: "Station Taxi Pont", type: "taxi", id: 6 },
            
            // Sidi Mabrouk
            { lat: 36.3490, lng: 6.5990, nom: "Station Taxi Sidi Mabrouk", type: "taxi", id: 7 },
            { lat: 36.3470, lng: 6.6010, nom: "Station Taxi Sidi Mabrouk Centre", type: "taxi", id: 8 },
            
            // Daksi
            { lat: 36.3390, lng: 6.5890, nom: "Station Taxi Daksi", type: "taxi", id: 9 },
            
            // Ain Smara
            { lat: 36.3290, lng: 6.5790, nom: "Station Taxi Ain Smara", type: "taxi", id: 10 },
            { lat: 36.3310, lng: 6.5810, nom: "Station Taxi Ain Smara Nord", type: "taxi", id: 11 },
            
            // Gammas
            { lat: 36.3570, lng: 6.6150, nom: "Station Taxi Gammas", type: "taxi", id: 12 },
            
            // Ali Mendjli - Distribution √©largie
            { lat: 36.2840, lng: 6.6410, nom: "Station Taxi Ali Mendjli Centre", type: "taxi", id: 13 },
            { lat: 36.2820, lng: 6.6390, nom: "Station Taxi Ali Mendjli Sud", type: "taxi", id: 14 },
            { lat: 36.2860, lng: 6.6430, nom: "Station Taxi Ali Mendjli Nord", type: "taxi", id: 15 },
            { lat: 36.2880, lng: 6.6450, nom: "Station Taxi Ali Mendjli Est", type: "taxi", id: 16 },
            { lat: 36.2800, lng: 6.6400, nom: "Station Taxi Ali Mendjli Ouest", type: "taxi", id: 17 },
            { lat: 36.2890, lng: 6.6420, nom: "Station Taxi Ali Mendjli Terminal", type: "taxi", id: 18 },
            { lat: 36.2780, lng: 6.6420, nom: "Station Taxi Ali Mendjli P√©riph√©rie", type: "taxi", id: 19 },
            
            // El Khroub
            { lat: 36.4550, lng: 6.6910, nom: "Station Taxi El Khroub Centre", type: "taxi", id: 20 },
            { lat: 36.4570, lng: 6.6930, nom: "Station Taxi El Khroub Nord", type: "taxi", id: 21 },
            { lat: 36.4510, lng: 6.6890, nom: "Station Taxi El Khroub Sud", type: "taxi", id: 22 }
        ];
        
        // Donn√©es des taxis irr√©guliers (points rouges)
        const taxisIrreguliers = [
            // Constantine Centre - quelques points dispers√©s
            { lat: 36.3675, lng: 6.6135, nom: "Taxi Irr√©gulier Pont Sidi M'Cid", type: "taxi_irreg", id: 1 },
            { lat: 36.3655, lng: 6.6175, nom: "Taxi Irr√©gulier Centre", type: "taxi_irreg", id: 2 },
            { lat: 36.3635, lng: 6.6155, nom: "Taxi Irr√©gulier Bardo", type: "taxi_irreg", id: 3 },
            { lat: 36.3715, lng: 6.6125, nom: "Taxi Irr√©gulier Universit√©", type: "taxi_irreg", id: 4 },
            
            // Sidi Mabrouk
            { lat: 36.3485, lng: 6.5995, nom: "Taxi Irr√©gulier Sidi Mabrouk", type: "taxi_irreg", id: 5 },
            { lat: 36.3465, lng: 6.6015, nom: "Taxi Irr√©gulier Sidi Mabrouk Centre", type: "taxi_irreg", id: 6 },
            
            // Daksi
            { lat: 36.3395, lng: 6.5895, nom: "Taxi Irr√©gulier Daksi", type: "taxi_irreg", id: 7 },
            
            // Ain Smara
            { lat: 36.3295, lng: 6.5795, nom: "Taxi Irr√©gulier Ain Smara", type: "taxi_irreg", id: 8 },
            { lat: 36.3315, lng: 6.5815, nom: "Taxi Irr√©gulier Ain Smara Nord", type: "taxi_irreg", id: 9 },
            
            // Gammas/Boussouf
            { lat: 36.3565, lng: 6.6135, nom: "Taxi Irr√©gulier Gammas", type: "taxi_irreg", id: 10 },
            { lat: 36.3545, lng: 6.6125, nom: "Taxi Irr√©gulier Boussouf", type: "taxi_irreg", id: 11 },
            
            // Ali Mendjli - quelques points
            { lat: 36.2835, lng: 6.6405, nom: "Taxi Irr√©gulier Ali Mendjli Centre", type: "taxi_irreg", id: 12 },
            { lat: 36.2855, lng: 6.6425, nom: "Taxi Irr√©gulier Ali Mendjli Nord", type: "taxi_irreg", id: 13 },
            { lat: 36.2815, lng: 6.6385, nom: "Taxi Irr√©gulier Ali Mendjli Sud", type: "taxi_irreg", id: 14 },
            { lat: 36.2875, lng: 6.6445, nom: "Taxi Irr√©gulier Ali Mendjli Est", type: "taxi_irreg", id: 15 },
            { lat: 36.2795, lng: 6.6415, nom: "Taxi Irr√©gulier Ali Mendjli Ouest", type: "taxi_irreg", id: 16 },
            
            // El Khroub - quelques points
            { lat: 36.4545, lng: 6.6905, nom: "Taxi Irr√©gulier El Khroub Centre", type: "taxi_irreg", id: 17 },
            { lat: 36.4575, lng: 6.6925, nom: "Taxi Irr√©gulier El Khroub Nord", type: "taxi_irreg", id: 18 },
            { lat: 36.4515, lng: 6.6885, nom: "Taxi Irr√©gulier El Khroub Sud", type: "taxi_irreg", id: 19 }
        ];
        
        // Configuration des styles avec les couleurs demand√©es
        const styles = {
            bus: { color: '#0066ff', fillColor: '#0066ff', radius: 8 },
            taxi: { color: '#ffff00', fillColor: '#ffff00', radius: 8 },
            taxi_irreg: { color: '#ff0000', fillColor: '#ff0000', radius: 8 }
        };
        
        // Initialisation de la carte
        function initMap() {
            // Masquer le loading
            document.getElementById('loading').style.display = 'none';
            
            // Cr√©er la carte centr√©e sur Constantine avec zoom ajust√©
            const map = L.map('map').setView([36.365, 6.6147], 11);
            
            // Ajouter les tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Fonction pour cr√©er un marqueur
            function createMarker(point, style) {
                const marker = L.circleMarker([point.lat, point.lng], {
                    color: '#333',
                    weight: 2,
                    fillColor: style.fillColor,
                    fillOpacity: 0.8,
                    radius: style.radius
                });
                
                // Popup avec informations d√©taill√©es
                const popupContent = `
                    <div class="popup-content">
                        <h3>${point.nom}</h3>
                        <p><strong>ID:</strong> ${point.id}</p>
                        <p><strong>Type:</strong> ${getTypeLabel(point.type)}</p>
                        <p><strong>Coordonn√©es:</strong> ${point.lat.toFixed(4)}, ${point.lng.toFixed(4)}</p>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                return marker;
            }
            
            // Fonction pour obtenir le label du type
            function getTypeLabel(type) {
                switch(type) {
                    case 'bus': return 'Arr√™t de Bus';
                    case 'taxi': return 'Station de Taxi';
                    case 'taxi_irreg': return 'Taxi Irr√©gulier';
                    default: return 'Inconnu';
                }
            }
            
            // Ajouter tous les marqueurs pour chaque type
            console.log('Ajout des arr√™ts de bus:', arretsBus.length);
            arretsBus.forEach(point => {
                createMarker(point, styles.bus).addTo(map);
            });
            
            console.log('Ajout des stations de taxi:', arretsTaxi.length);
            arretsTaxi.forEach(point => {
                createMarker(point, styles.taxi).addTo(map);
            });
            
            console.log('Ajout des taxis irr√©guliers:', taxisIrreguliers.length);
            taxisIrreguliers.forEach(point => {
                createMarker(point, styles.taxi_irreg).addTo(map);
            });
            
            // Ajouter la l√©gende sans les nombres
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <h4>L√©gende</h4>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #0066ff;"></span>
                        Arr√™ts de Bus
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ffff00; border: 1px solid #ccc;"></span>
                        Stations de Taxi
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #ff0000;"></span>
                        Taxis Irr√©guliers
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
            
            // Ajouter un contr√¥le d'√©chelle
            L.control.scale().addTo(map);
            
            // Calculer les limites pour centrer la vue sur tous les points
            const allPoints = [...arretsBus, ...arretsTaxi, ...taxisIrreguliers];
            if (allPoints.length > 0) {
                const group = new L.featureGroup(
                    allPoints.map(point => L.marker([point.lat, point.lng]))
                );
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            console.log('Carte interactive charg√©e avec succ√®s');
            console.log(`Total des points affich√©s: ${allPoints.length}`);
            console.log('- Arr√™ts de bus:', arretsBus.length);
            console.log('- Stations de taxi:', arretsTaxi.length);
            console.log('- Taxis irr√©guliers:', taxisIrreguliers.length);
        }
        
        // Initialiser la carte quand la page est charg√©e
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
